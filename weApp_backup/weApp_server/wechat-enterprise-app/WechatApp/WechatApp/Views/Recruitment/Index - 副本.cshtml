@{
    Layout = null;
}
@model List<WechatApp.Models.Question>
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0 minimal-ui" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <title>性格测试</title>

    <link rel="stylesheet" href="../Contents/StylesJs/weui.min.css" />
    <link rel="stylesheet" href="../Contents/StylesJs/example.css" />
    <style type="text/css">
        .last-column {
            margin-right: 0% !important;
        }

        .no-bottom {
            padding-bottom: 0px;
            margin-bottom: 0px !important;
        }

        .last-column p {
            color: #595959;
        }

        .last-column p {
            line-height: 30px;
            margin-bottom: 30px;
            font-size: 13px;
            letter-spacing: 0px;
        }

        .one-quarter p {
            line-height: 30px;
            margin-bottom: 30px;
            font-size: 13px;
            letter-spacing: 0px;
        }

        .radio-one-checked {
            background-image: url("../Contents/images/ui/radio1c.png");
            background-size: 16px 18px;
            background-repeat: no-repeat;
            padding-left: 30px;
            background-position: 0px -1px;
            margin-bottom: 10px;
        }

        .radio-one {
            background-image: url("../Contents/images/ui/radio1.png");
            background-size: 16px 18px;
            background-repeat: no-repeat;
            padding-left: 30px;
            background-position: 0px -1px;
            margin-bottom: 10px;
        }

        .checkbox {
            color: #666;
        }

        .last-column p > a {
            display: inline;
            text-decoration: none;
        }

        .material-box {
            background-color: #FFF;
            margin-left: 10px;
            margin-right: 10px;
            padding: 30px 20px;
            /*box-shadow: 0px 2px 5px 1px rgba(0, 0, 0, 0.1);*/
            margin-bottom: 30px;
            /*border-radius: 2px;*/
        }
    </style>

</head>
<body ontouchstart>
    @if (ViewBag.IsCarList)
    {
        <div class="page">
            <div class="hd" style="padding:10px 10px 10px 0px">
                <h3 class="page_title" style=" font-size:18px; margin:0px; width:100%"> 欢迎<b> @ViewBag.UserName</b>  参加卡斯柯面试</h3>
                <input type="hidden" value="@ViewBag.UserId" id="user" />
            </div>
            <div class="bd">
                <p style=" font-size:13px">
                    说明：请你仔细阅读下面的每一个问题。
                </p>
                <h4><b>一 气质测试</b></h4>
                @if (Model != null && Model.Count > 0)
                {
                    foreach (var order in Model)
                    {
                        if (order.Type == 1)
                        {
                            <text>
                                <div class="weui_cells_title">@order.OrderNo  @order.Description</div>
                                <div class="weui_cells weui_cells_radio" data-kpi="@order.Type" data-seqnr="@order.Id">
                                    <label class="weui_cell weui_check_label" for="@(order.Id.ToString()+1)">
                                        <div class="weui_cell_bd weui_cell_primary">
                                            <p>很符合</p>
                                        </div>
                                        <div class="weui_cell_ft">
                                            <input type="radio" class="weui_check" name="@order.Id.ToString()" id="@(order.Id.ToString()+1)" value="2" data-value="2" >
                                            <span class="weui_icon_checked"></span>
                                        </div>
                                    </label>
                                    <label class="weui_cell weui_check_label" for="@(order.Id.ToString()+2)">
                                        <div class="weui_cell_bd weui_cell_primary">
                                            <p>比较符合</p>
                                        </div>
                                        <div class="weui_cell_ft">
                                            <input type="radio" name="@order.Id.ToString()" class="weui_check" id="@(order.Id.ToString()+2)" value="1" data-value="1">
                                            <span class="weui_icon_checked"></span>
                                        </div>

                                    </label>
                                    <label class="weui_cell weui_check_label" for="@(order.Id.ToString()+3)">
                                        <div class="weui_cell_bd weui_cell_primary">
                                            <p>符合与不符合之间</p>
                                        </div>
                                        <div class="weui_cell_ft">
                                            <input type="radio" name="@order.Id.ToString()" class="weui_check" id="@(order.Id.ToString()+3)" value="0" data-value="0">
                                            <span class="weui_icon_checked"></span>
                                        </div>

                                    </label>
                                    <label class="weui_cell weui_check_label" for="@(order.Id.ToString()+4)">
                                        <div class="weui_cell_bd weui_cell_primary">
                                            <p>比较不符合</p>
                                        </div>
                                        <div class="weui_cell_ft">
                                            <input type="radio" name="@order.Id.ToString()" class="weui_check" id="@(order.Id.ToString()+4)" value="-1" data-value="-1">
                                            <span class="weui_icon_checked"></span>
                                        </div>

                                    </label>
                                    <label class="weui_cell weui_check_label" for="@(order.Id.ToString()+5)">
                                        <div class="weui_cell_bd weui_cell_primary">
                                            <p>完全不符合</p>
                                        </div>
                                        <div class="weui_cell_ft">
                                            <input type="radio" name="@order.Id.ToString()" class="weui_check" id="@(order.Id.ToString()+5)" value="-2" data-value="-2">
                                            <span class="weui_icon_checked"></span>
                                        </div>
                                    </label>
                                </div>
                            </text>
                        }
                    }
                }

                <h4><b>二 职业人格测试</b></h4>
                @if (Model != null && Model.Count > 0)
                {
                    foreach (var order in Model)
                    {
                        if (order.Type == 2)
                        {
                            <text>
                                <div class="weui_cells_title">@order.OrderNo  @order.Description</div>
                                <div class="weui_cells weui_cells_radio" data-kpi="@order.Type" data-seqnr="@order.Id">
                                    <label class="weui_cell weui_check_label" for="@(order.Id.ToString()+1)">
                                        <div class="weui_cell_bd weui_cell_primary">
                                            <p>符合</p>
                                        </div>
                                        <div class="weui_cell_ft">
                                            <input type="radio" class="weui_check" name="@order.Id.ToString()" id="@(order.Id.ToString()+1)" value="1" data-value="1" >
                                            <span class="weui_icon_checked"></span>
                                        </div>
                                    </label>
                                    <label class="weui_cell weui_check_label" for="@(order.Id.ToString()+2)">
                                        <div class="weui_cell_bd weui_cell_primary">
                                            <p>不符合</p>
                                        </div>
                                        <div class="weui_cell_ft">
                                            <input type="radio" name="@order.Id.ToString()" class="weui_check" id="@(order.Id.ToString()+2)" value="11" data-value="-1">
                                            <span class="weui_icon_checked"></span>
                                        </div>
                                    </label>

                                </div>
                            </text>
                        }
                    }
                }
                <div class="bd spacing">
                    <div>
                        <input class="weui_btn weui_btn_primary" type="button" name="review-submit" id="review-submit" value="提交" />
                    </div>
                </div>
                <!--BEGIN dialog2-->
                <div class="weui_dialog_alert" id="dialog2" style="display: none;">
                    <div class="weui_mask"></div>
                    <div class="weui_dialog">
                        <div class="weui_dialog_hd"><strong class="weui_dialog_title">提示</strong></div>
                        <div class="weui_dialog_bd">弹窗内容，告知当前页面信息等</div>
                        <div class="weui_dialog_ft">
                            <a href="javascript:;" class="weui_btn_dialog primary">确定</a>
                        </div>
                    </div>
                </div>
                <!--END dialog2-->
            </div>
            <div class="weui_msg" id="msg2" style="display: none;">
                <div class="weui_icon_area"><i class="weui_icon_success weui_icon_msg"></i></div>
                <div class="weui_text_area">
                    <h2 class="weui_msg_title">操作成功</h2>
                    <p class="weui_msg_desc">请联系相关人员安排进一步笔试</p>
                </div>
                <div class="weui_opr_area">
                    <p class="weui_btn_area">
                        <a href="javascript:window.close();" class="weui_btn weui_btn_primary">关闭</a>
                    </p>
                </div>
            </div>
        </div>

    }
    else
    {
        <div class="page">
            <div class="hd" style="padding:10px 10px 10px 0px">
                <h4 class="page_title">登记</h4>
            </div>
            <div class="bd">
                <form action="/Recruitment/Index" method="post" class="date1Form" id="date1Form" style=" border:0px; margin-top:2px">
                    <fieldset style="border:0px;">
                        <div class="weui_cells_title"></div>
                        <div class="weui_cells weui_cells_form">
                            <div class="weui_cell">
                                <div class="weui_cell_hd"><label class="weui_label">姓名</label></div>
                                <div class="weui_cell_bd weui_cell_primary">
                                    <input class="weui_input" type="text" placeholder="请输入姓名" name="UserName" id="contactNameField" />
                                </div>
                            </div>
                            <div class="weui_cell weui_cell_select weui_select_after">
                                <div class="weui_cell_hd">
                                    性别
                                </div>
                                <div class="weui_cell_bd weui_cell_primary">
                                    <select class="weui_select" name="UserSex" id="contactSexField">
                                        <option value="0">--请选择--</option>
                                        <option value="男">男</option>
                                        <option value="女">女</option>
                                    </select>
                                </div>
                            </div>
                            <div class="weui_cell">
                                <div class="weui_cell_hd"><label class="weui_label">电话</label></div>
                                <div class="weui_cell_bd weui_cell_primary">
                                    <input class="weui_input" type="tel" placeholder="请输入电话" name="UserPhone" id="contactPhoneField" />
                                </div>
                            </div>
                            <div class="weui_cell">
                                <div class="weui_cell_hd"><label class="weui_label">年龄</label></div>
                                <div class="weui_cell_bd weui_cell_primary">
                                    <input class="weui_input" type="number" placeholder="请输入年龄" name="UserAge" id="contactAgeField" />
                                </div>
                            </div>
                            <div class="weui_cell weui_cell_select weui_select_after">
                                <div class="weui_cell_hd">
                                    学历
                                </div>
                                <div class="weui_cell_bd weui_cell_primary">
                                    <select class="weui_select" name="UserDegree" id="contactDegreeField">
                                        <option value="0">--请选择--</option>
                                        <option value="专科">专科</option>
                                        <option value="本科">本科</option>
                                        <option value="硕士研究生">硕士研究生</option>
                                        <option value="博士研究生">博士研究生</option>
                                    </select>
                                </div>
                            </div>

                            <div class="weui_cell">
                                <div class="weui_cell_hd"><label class="weui_label">学校</label></div>
                                <div class="weui_cell_bd weui_cell_primary">
                                    <input class="weui_input" type="text" placeholder="请输入学校" name="UserSchool" id="contactSchoolField" />
                                </div>
                            </div>
                            <div class="weui_cell">
                                <div class="weui_cell_hd"><label class="weui_label">专业</label></div>
                                <div class="weui_cell_bd weui_cell_primary">
                                    <input class="weui_input" type="text" placeholder="请输入专业" name="UserMajor" id="contactMajorField" />
                                </div>
                            </div>

                            <div class="bd spacing">
                                @*<a href="javascript:;" class="weui_btn weui_btn_primary">提交</a>*@
                                <input type="submit" class="weui_btn weui_btn_primary" id="date1SubmitButton" value="提交" data-formid="date1Form" />
                            </div>
                        </div>
                    </fieldset>
                </form>
                <!--BEGIN dialog2-->
                <div class="weui_dialog_alert" id="dialog3" style="display: none;">
                    <div class="weui_mask"></div>
                    <div class="weui_dialog">
                        <div class="weui_dialog_hd"><strong class="weui_dialog_title">提示</strong></div>
                        <div class="weui_dialog_bd">弹窗内容，告知当前页面信息等</div>
                        <div class="weui_dialog_ft">
                            <a href="javascript:;" class="weui_btn_dialog primary">确定</a>
                        </div>
                    </div>
                </div>
                <!--END dialog2-->
            </div>
        </div>
    }
    <script src="../Contents/StylesJs/zepto.min.js"></script>
    <script src="../Contents/StylesJs/example.js"></script>
    <script type="text/javascript">
        function Score(UserID, QuestionID, Score) {
            this.UserID = UserID;
            this.QuestionID = QuestionID;
            this.Score = Score;
        }
        function Validate() {
            if (!$("#contactNameField").val()) {
                $("#dialog3").find(".weui_dialog_bd").text("名字不能为空").parent().parent().show();
                $('#dialog3').find('.weui_btn_dialog').on('click', function () {
                    $('#dialog3').hide();
                });
                return false;
            }
            if (!$("#contactPhoneField").val()) {
                $("#dialog3").find(".weui_dialog_bd").text("电话不能为空").parent().parent().show();
                $('#dialog3').find('.weui_btn_dialog').on('click', function () {
                    $('#dialog3').hide();
                });
                return false;
            }
            if (!$("#contactAgeField").val()) {
                $("#dialog3").find(".weui_dialog_bd").text("年龄不能为空").parent().parent().show();
                $('#dialog3').find('.weui_btn_dialog').on('click', function () {
                    $('#dialog3').hide();
                });
                return false;
            }
            if (!$("#contactSchoolField").val()) {
                $("#dialog3").find(".weui_dialog_bd").text("学校不能为空").parent().parent().show();
                $('#dialog3').find('.weui_btn_dialog').on('click', function () {
                    $('#dialog3').hide();
                });
                return false;
            }
            if (!$("#contactMajorField").val()) {
                $("#dialog3").find(".weui_dialog_bd").text("专业不能为空").parent().parent().show();
                $('#dialog3').find('.weui_btn_dialog').on('click', function () {
                    $('#dialog3').hide();
                });
                return false;
            }
            if (!$("#contactDegreeField").val() || $("#contactDegreeField").val() == "0") {
                $("#dialog3").find(".weui_dialog_bd").text("请选择学历").parent().parent().show();
                $('#dialog3').find('.weui_btn_dialog').on('click', function () {
                    $('#dialog3').hide();
                });
                return false;
            }
            if (!$("#contactSexField").val() || $("#contactSexField").val() == "0") {
                $("#dialog3").find(".weui_dialog_bd").text("请选择性别").parent().parent().show();
                $('#dialog3').find('.weui_btn_dialog').on('click', function () {
                    $('#dialog3').hide();
                });
                return false;
            }
            return true;

        }
        $("#date1Form").submit(function () {
            return Validate();
        });

        $("#review-submit").click(function () {
            var isOk = true;
            var metype = "";
            var scores = [];
            $(".weui_cells_radio").each(function (i) {
                var radioChecked = $(this).find('input[type=radio]:checked');
                var datakpi = $(this).attr("data-kpi");
                if (i >= 60) {
                    i = i - 60;
                }
                if (datakpi == "1") {
                    metype = "气质测试";
                } else if (datakpi == "2") {
                    metype = "职业人格测试";
                }
                if (!radioChecked.length) {
                    $("#dialog2").find(".weui_dialog_bd").text(metype + "第" + (i + 1) + "项没有评分").parent().parent().show();
                    $('#dialog2').find('.weui_btn_dialog').on('click', function () {
                        $('#dialog2').hide();
                    });
                    isOk = false;
                    return false;
                } else {
                    var radio = radioChecked.first();
                    var score = new Score();
                    score.UserID = $('#user').attr('value').toString().trim();
                    score.QuestionID = $(this).attr("data-seqnr");
                    score.Score = radio.attr("data-value");
                    scores.push(score);
                }
            });
            if (isOk) {
                var user = $('#user').attr('value').toString().trim();
                if (!user) {
                    $("#dialog2").find(".weui_dialog_bd").text("请先登录").parent().parent().show();
                    $('#dialog2').find('.weui_btn_dialog').on('click', function () {
                        $('#dialog2').hide();
                    });
                    return;
                }
                var postData = {
                    UserID: user,
                    scores: scores
                };

                $("#review-submit").attr("value", "提交中...").attr("disabled", "disabled");
                $.ajax({
                    type: "POST",
                    url: "/Recruitment/ResultInfo",
                    timeout: 900000, //超时时间设置，单位毫秒
                    contentType: "application/json",//这个一定要加上哟！
                    dataType: "json",
                    data: JSON.stringify(postData),
                    success: function (data) {
                        $(".bd").hide();
                        $(".hd").hide();
                        $(".weui_msg").show();
                        $('#msg2').find('.weui_btn_primary').on('click', function () {
                            // $('#msg2').hide();
                        });
                    },
                    fail: function (data) {
                        $("#review-submit").attr("value", "提交").attr("disabled", "");
                        $("#dialog2").find(".weui_dialog_bd").text("服务器错误").parent().parent().show();
                        $('#dialog2').find('.weui_btn_dialog').on('click', function () {
                            $('#dialog2').hide();
                        });
                    }
                });
            }
        })
    </script>
</body>
</html>
