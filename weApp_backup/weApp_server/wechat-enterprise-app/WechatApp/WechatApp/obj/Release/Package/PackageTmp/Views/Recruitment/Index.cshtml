@{
    Layout = null;
}
@model List<WechatApp.Models.Question>
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0 minimal-ui" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <title>测试题</title>

    <link href="~/Contents/Styles/framework.css" rel="stylesheet" />
    <link href="~/Contents/Styles/style.css" rel="stylesheet" />
    <link href="~/Contents/Styles/owl.theme.css" rel="stylesheet" />
    <link href="~/Contents/Styles/swipebox.css" rel="stylesheet" />
    <link href="~/Contents/Styles/font-awesome.css" rel="stylesheet" />
    <link href="~/Contents/Styles/animate.css" rel="stylesheet" />

    <script src="~/Contents/Scripts/jquery.js"></script>
    <script src="~/Contents/Scripts/jqueryui.js"></script>
    <script src="~/Contents/Scripts/framework.plugins.js"></script>
    <script src="~/Contents/Scripts/custom.js"></script>
    <script src="~/Contents/Scripts/jquery.validate.js"></script>
    <style type="text/css">
        img.responsive-image {
            margin-bottom: 2px;
        }

        p.notification-page-item {
            padding: 8px 20px 8px 10px;
            margin-bottom: 10px;
        }

            p.notification-page-item i:first-child {
                height: 30px;
                width: 30px;
                line-height: 30px;
                font-size: 11px;
            }
    </style>

</head>
<body>
    <div id="preloader">
        <div id="status">
            <p class="center-text">
                页面加载中...
            </p>
        </div>
    </div>
    <div class="all-elements">

        <div id="content" class="snap-content">
            @if (ViewBag.IsCarList)
            {
                <div class="static-notification-red">
                    <p class="center-text"></p>
                </div>
                <div class="static-notification-green">
                    <p class="center-text">提交成功</p>
                </div>
                <div class="container material-box" style="padding-bottom:20px;padding-top:20px">
                    <div class="one-half">
                        <h4>@ViewBag.UserName  欢迎参加卡斯柯信号有限公司面试</h4>
                        <input type="hidden" value="@ViewBag.UserId" id="user" />
                    </div>
                </div>
                <div class="container material-box">
                    <p>
                        说明：请你仔细阅读下面的每一个问题。
                    </p>
                    <h4><b>一 气质测试</b></h4>
                    @if (Model != null && Model.Count > 0)
                    {
                        foreach (var order in Model)
                        {
                            if (order.Type == 1)
                            {
                                <text>

                                    <div>
                                        <div class="one-quarter"><p class="no-bottom">@order.OrderNo  @order.Description </p></div>
                                        <div class="last-column">
                                            <p class="no-bottom choice" data-kpi="@order.Type" data-seqnr="@order.Id">
                                                <a href="#" data-value="2" class="checkbox radio-one radio-one-checked">很符合</a>
                                                <a href="#" data-value="1" class="checkbox radio-one">比较符合</a>
                                                <a href="#" data-value="0" class="checkbox radio-one">符合与不符合之间</a>
                                                <a href="#" data-value="-1" class="checkbox radio-one">比较不符合</a>
                                                <a href="#" data-value="-2" class="checkbox radio-one">完全不符合</a>

                                            </p>
                                        </div>
                                    </div>
                                </text>
                            }
                        }
                    }
                    <h4><b>二 职业人格测试</b></h4>
                    @if (Model != null && Model.Count > 0)
                    {
                        foreach (var order in Model)
                        {
                            if (order.Type == 2)
                            {
                                <text>
                                    <div>
                                        <div class="one-quarter"><p class="no-bottom">@order.OrderNo  @order.Description </p></div>
                                        <div class="last-column">
                                            <p class="no-bottom choice" data-kpi="@order.Type" data-seqnr="@order.Id">
                                                <a href="#" data-value="1" class="checkbox radio-one radio-one-checked">符合</a>
                                                <a href="#" data-value="-1" class="checkbox radio-one">不符合</a>

                                            </p>
                                        </div>
                                    </div>
                                </text>
                            }
                        }
                    }
                    <div class="decoration content"></div>
                    <div>
                        <input class="buttonWrap button button-green contactSubmitButton" type="button" name="review-submit" id="review-submit" value="提交" />
                    </div>
                </div>
            }
            else
            {

                <div>
                    <form action="/Recruitment/Index" method="post" class="date1Form" id="date1Form">
                        <fieldset>
                            <div class="formFieldWrap">
                                <label class="field-title contactPhoneField textNameField" for="contactNameField">姓名:</label>
                                <input type="text" name="UserName" value="" class="contactField requiredField" id="contactNameField" />
                            </div>
                            <div class="formFieldWrap" style="height:60px; ">
                                <label class="field-title originNameField textNameField" style=" padding-bottom: 7px;" for="UserSex">性别:</label>
                                <input type="radio" name="UserSex" value="男" class="requiredField UserSexInfo" style=" display:inline-block;">男
                                &nbsp; &nbsp;&nbsp;&nbsp;
                                <input type="radio" name="UserSex" value="女" class="requiredField UserSexInfo" style="display: inline-block; ">女
                            </div>
                            <div class="formFieldWrap">
                                <label class="field-title contactPhoneField textNameField" for="contactPhoneField">电话:</label>
                                <input type="text" name="UserPhone" value="" class="contactField  requiredField" id="contactPhoneField" />
                            </div>
                            <div class="formFieldWrap">
                                <label class="field-title contactAgeField textNameField" for="contactAgeField">年龄:</label>
                                <input type="text" name="UserAge" value="" class="contactField  requiredField" id="contactAgeField" />
                            </div>
                            <div class="formFieldWrap">
                                <label class="field-title contactDegreeField textNameField" for="contactDegreeField">学历:</label>
                                <select name="UserDegree" class="contactField requiredField" id="contactDegreeField">
                                    <option value="本科">本科</option>
                                    <option value="硕士研究生">硕士研究生</option>
                                    <option value="博士研究生">博士研究生</option>
                                </select>
                            </div>
                            <div class="formFieldWrap">
                                <label class="field-title contactSchoolField textNameField" for="contactSchoolField">学校:</label>
                                <input type="text" name="UserSchool" value="" class="contactField  requiredField" id="contactSchoolField" />
                            </div>
                            <div class="formFieldWrap">
                                <label class="field-title contactMajorField textNameField" for="contactMajorField">专业:</label>
                                <input type="text" name="UserMajor" value="" class="contactField  requiredField" id="contactMajorField" />
                            </div>
                            <div class="formSubmitButtonErrorsWrap">
                                <input type="submit" class="buttonWrap button button-green date1SubmitButton" id="date1SubmitButton" value="提交" data-formid="date1Form" style="min-width:100%" />
                            </div>
                        </fieldset>
                    </form>
                </div>
            }
        </div>

    </div>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script type="text/javascript">

        wx.error(function (res) {
            console.log(res);
        });


        function Score(UserID, QuestionID, Score) {
            this.UserID = UserID;
            this.QuestionID = QuestionID;
            this.Score = Score;
        }

        function Validate() {
            if (!jQuery("#contactNameField").val()) {
                alert('名字不能为空');
                return false;
            }
            if (!jQuery("#contactPhoneField").val()) {
                alert('电话不能为空');
                return false;
            }
            if (!jQuery("#contactAgeField").val()) {
                alert('年龄不能为空');
                return false;
            }
            if (!jQuery('input[name="UserSex"]:checked').val()) {
                {
                    alert('请选择性别');
                    return false;
                }
            }

        }
        jQuery("#date1Form").submit(function () {
            return Validate();
        });

        var guid = function () {
            var s = [];
            var hexDigits = "0123456789abcdef";
            for (var i = 0; i < 36; i++) {
                s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
            }
            s[14] = "4";  // bits 12-15 of the time_hi_and_version field to 0010
            s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);  // bits 6-7 of the clock_seq_hi_and_reserved to 01
            s[8] = s[13] = s[18] = s[23] = "-";

            var uuid = s.join("");
            return uuid.split("-").join("");
        }
        var getQueryString = function (name) {
            if (!name) {
                return null;
            }
            var search = window.location.search;
            var reg = new RegExp("[&?]" + name + "=([^&]+)");
            if (reg.test(search)) {
                return RegExp.$1;
            }
            return null;
        }

        jQuery(".static-notification-red").hide();
        jQuery(".static-notification-green").hide();

        jQuery(".radio-one").click(function (event) {
            jQuery(event.target).siblings().removeClass("radio-one-checked");
        })

        jQuery("#review-submit").click(function () {
            var isOk = true;
            var scores = [];
            jQuery(".choice").each(function (i) {
                var radioChecked = jQuery(this).find(".radio-one-checked");
                if (!radioChecked.length) {
                    jQuery(".static-notification-red").find("p").text("第" + (i + 1) + "项没有评分").parent().show();
                    setTimeout(function () {
                        jQuery(".static-notification-red").fadeOut("slow");
                    }, 3000);
                    isOk = false;
                    return false;
                } else {
                    var radio = radioChecked.first();
                    var score = new Score();
                    score.UserID = jQuery('#user').attr('value').toString().trim();
                    score.QuestionID = jQuery(this).attr("data-seqnr");
                    score.Score = radio.attr("data-value");
                    scores.push(score);
                }
            });
            if (isOk) {
                var user = jQuery('#user').attr('value').toString().trim();
                if (!user) {
                    jQuery(".static-notification-red").find("p").text("请登录").parent().show();
                    setTimeout(function () {
                        jQuery(".static-notification-red").fadeOut("slow");
                    }, 3000);
                    return;
                }
                var postData = {
                    UserID: user,
                    scores: scores
                };

                jQuery("#review-submit").attr("value", "提交中...").attr("disabled", "disabled");
                jQuery.ajax({
                    type: "POST",
                    url: "/Recruitment/ResultInfo",
                    timeout: 900000, //超时时间设置，单位毫秒
                    contentType: "application/json",//这个一定要加上哟！
                    dataType: "json",
                    data: JSON.stringify(postData),
                    success: function (data) {

                        jQuery(".container").hide();
                        jQuery(".static-notification-green").fadeIn("slow");
                    },
                    fail: function (data) {
                        jQuery("#review-submit").attr("value", "提交").attr("disabled", "");
                        jQuery(".static-notification-red").find("p").text("服务器错误").parent().show();
                    }
                });
            }
        })
    </script>
</body>
</html>
